!function(o,a,i){var t=function(n,t){this.elem=n,this.$elem=o(n),this.options=t,this.metadata=this.$elem.data("plugin-options"),this.$nav=this.$elem.find("a"),this.$win=o(a),this.sections={},this.didScroll=!1,this.$doc=o(i),this.docHeight=this.$doc.height()};t.prototype={defaults:{currentClass:"current",changeHash:!1,easing:"swing",filter:":not(.external)",scrollSpeed:750,scrollOffset:0,scrollThreshold:.5,begin:!1,end:!1,scrollChange:!1},init:function(){var n=this;return n.config=o.extend({},n.defaults,n.options,n.metadata),""!==n.config.filter&&(n.$nav=n.$nav.filter(n.config.filter)),n.$nav.on("click.onePageNav",o.proxy(n.handleClick,n)),n.getPositions(),n.bindInterval(),n.$win.on("resize.onePageNav",o.proxy(n.getPositions,n)),this},adjustNav:function(n,t){n.$elem.find("."+n.config.currentClass).removeClass(n.config.currentClass),t.addClass(n.config.currentClass)},bindInterval:function(){var n,t=this;t.$win.on("scroll.onePageNav",function(){t.didScroll=!0}),t.t=setInterval(function(){n=t.$doc.height(),t.didScroll&&(t.didScroll=!1,t.scrollChange()),n!==t.docHeight&&(t.docHeight=n,t.getPositions())},250)},getHash:function(n){return n.attr("href").split("#")[1]},getPositions:function(){var n,t,i=this;i.$nav.each(function(){n=i.getHash(o(this)),t=o("#"+n).offset().top,i.sections[n]=Math.round(t)-i.config.scrollOffset})},getSection:function(n){var t=null,i=Math.round(this.$win.height()*this.config.scrollThreshold);for(var e in this.sections)this.sections[e]-i<n&&(t=e);return t},handleClick:function(n){var t=this,i=o(n.currentTarget),e=i.parent(),s="#"+t.getHash(i);e.hasClass(t.config.currentClass)||(t.config.begin&&t.config.begin(),t.adjustNav(t,e),t.unbindInterval(),o.scrollTo(s,t.config.scrollSpeed,{axis:"y",easing:t.config.easing,offset:{top:-t.config.scrollOffset},onAfter:function(){t.config.changeHash&&(a.location.hash=s),t.bindInterval(),t.config.end&&t.config.end()}})),n.preventDefault()},scrollChange:function(){var n,t=this.$win.scrollTop(),i=this.getSection(t);null!==i&&((n=this.$elem.find('a[href$="#'+i+'"]').parent()).hasClass(this.config.currentClass)||(this.adjustNav(this,n),this.config.scrollChange&&this.config.scrollChange(n)))},unbindInterval:function(){clearInterval(this.t),this.$win.unbind("scroll.onePageNav")}},t.defaults=t.prototype.defaults,o.fn.onePageNav=function(n){return this.each(function(){new t(this,n).init()})}}(jQuery,window,document);